<!DOCTYPE html>
<!-- Jonas Feb 8, 2019 -->
<html>
<title>
Quiz creator
</title>
<head>
  <!-- Accessing javascript from a separate file -->
  <script type="text/javascript" src="./dynamicCreator4qD.js"> </script>
 
  <script type="text/javascript" src="../../misc/connectToDB.js"> </script>

  <!-- Accessing Css from a separate file -->
  <link href="./dynamicCreator.css" rel="stylesheet" type="text/css">

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

</head>
<body>



<!-- tabs for selecting quizzes -->

<div class="tab">
  <button id= "default" class="tablinks" onclick="openCreator('quiz1')">Quiz1</button>
  <button class="tablinks" onclick="openCreator('quiz2')">Quiz2</button>
  <button class="tablinks" onclick="openCreator('quiz3')">Quiz3</button>
</div>

<div id="quiz1" class="tabcontent">
  <h3>QUIZ1</h3>
  <p> Create questions for QUIZ1</p>
  <br>
  <!-- Input for the name of the quiz -->
  <input value="Name" name="quizName" id='quizNameID'>

  <!-- Quiz maker table -->
  <table id="creatorForQ1" border="1">
    <!-- Labels for quiz master -->
    <tr>
      <th>index</th>
      <th>Question</th>
      <th>Related nodes</th>
      <th>Answers</th>
    </tr>



    <!--
          each question row has unique ids for its elements
          answer id format is made of two numbers:
          index of row and second answer index
    -->

      <!-- Q1 -->
    <tr>
      <td id='0'> 1 </td>
      <td><input type="text" name="Question" id = "q0"></td>
      <td><input type="text" name="Related nodes" id = "rn0"></td>
      <td> <div id ="answersQ0">
             <button onclick="hideORShow('hiddenPartQ0')"> Hide/show answers </button>
              <div id = "hiddenPartQ0">
                <!--
                <INPUT type="button" value="Add an answer" onclick="addAnswerRow('answersTableQ0')" />
                <INPUT type="button" value="Delete an answer" onclick="deleteQuestionRow('answersTableQ0')" />
                -->
                <table id="answersTableQ0" width= "350px" border="1">
                  <TR>
                    <td> a </td>
                    <TD> <input type="text" name="Answer" id='ans00'> </TD>
                    <td> <input type="checkbox" id='swc00'> </td>
                    <td> <input type="text" name="description" id='dc00'> </td>
                  </TR>
                  <TR>
                    <td> b </td>
                    <TD> <input type="text" name="Answer" id='ans01'></TD>
                    <td> <input type="checkbox" id='swc01'> </td>
                    <td> <input type="text" name="description" id='dc01'> </td>
                  </TR>
                  <TR>
                    <td> c </td>
                    <TD> <input type="text" name="Answer" id='ans02'> </TD>
                    <td> <input type="checkbox" id='swc02'> </td>
                    <td> <input type="text" name="description" id='dc02'> </td>
                  </TR>
                  <TR>
                    <td> d </td>
                    <TD> <input type="text" name="Answer" id='ans03'> </TD>
                    <td> <input type="checkbox" id='swc03'> </td>
                    <td> <input type="text" name="description" id='dc03'> </td>
                  </TR>
                </table>
              </div> <!-- hidden part -->
           </div> <!-- answersQ0 -->
      </td> <!-- the answer column = -->
    </tr>
    <!-- Q2 -->
    <tr>
      <td id='1'> 2 </td>
      <td><input type="text" name="Question" id = "q1"></td>
      <td><input type="text" name="Related nodes" id = "rn1"></td>
      <td> <div id ="answersQ1">
             <button onclick="hideORShow('hiddenPartQ1')"> Hide/show answers </button>
              <div id = "hiddenPartQ1">
                <!--
                <INPUT type="button" value="Add an answer" onclick="addAnswerRow('answersTableQ1')" />
                <INPUT type="button" value="Delete an answer" onclick="deleteQuestionRow('answersTableQ1')" />
                -->
                <table id="answersTableQ1" width= "350px" border="1">
                  <TR>
                    <td> a </td>
                    <TD> <input type="text" name="Answer" id='ans10'> </TD>
                    <td> <input type="checkbox" id='swc10'> </td>
                    <td> <input type="text" name="description" id='dc10'> </td>
                  </TR>
                  <TR>
                    <td> b </td>
                    <TD> <input type="text" name="Answer" id='ans11'></TD>
                    <td> <input type="checkbox" id='swc11'> </td>
                    <td> <input type="text" name="description" id='dc11'> </td>
                  </TR>
                  <TR>
                    <td> c </td>
                    <TD> <input type="text" name="Answer" id='ans12'> </TD>
                    <td> <input type="checkbox" id='swc12'> </td>
                    <td> <input type="text" name="description" id='dc12'> </td>
                  </TR>
                  <TR>
                    <td> d </td>
                    <TD> <input type="text" name="Answer" id='ans13'> </TD>
                    <td> <input type="checkbox" id='swc13'> </td>
                    <td> <input type="text" name="description" id='dc13'> </td>
                  </TR>
                </table>
              </div> <!-- hidden part -->
           </div> <!-- answersQ0 -->
      </td> <!-- the answer column -->
    </tr>
    <!-- Q3 -->
    <tr>
      <td id='2'> 3 </td>
      <td><input type="text" name="Question" id = "q2"></td>
      <td><input type="text" name="Related nodes" id = "rn2"></td>
      <td> <div id ="answersQ2">
             <button onclick="hideORShow('hiddenPartQ2')"> Hide/show answers </button>
              <div id = "hiddenPartQ2">
                <!--
                <INPUT type="button" value="Add an answer" onclick="addAnswerRow('answersTableQ2')" />
                <INPUT type="button" value="Delete an answer" onclick="deleteQuestionRow('answersTableQ2')" />
                -->
                <table id="answersTableQ2" width= "350px" border="1">
                  <TR>
                    <td> a </td>
                    <TD> <input type="text" name="Answer" id='ans20'> </TD>
                    <td> <input type="checkbox" id='swc20'> </td>
                    <td> <input type="text" name="description" id='dc20'> </td>
                  </TR>
                  <TR>
                    <td> b </td>
                    <TD> <input type="text" name="Answer" id='ans21'></TD>
                    <td> <input type="checkbox" id='swc21'> </td>
                    <td> <input type="text" name="description" id='dc21'> </td>
                  </TR>
                  <TR>
                    <td> c </td>
                    <TD> <input type="text" name="Answer" id='ans22'> </TD>
                    <td> <input type="checkbox" id='swc22'> </td>
                    <td> <input type="text" name="description" id='dc22'> </td>
                  </TR>
                  <TR>
                    <td> d </td>
                    <TD> <input type="text" name="Answer" id='ans23'> </TD>
                    <td> <input type="checkbox" id='swc23'> </td>
                    <td> <input type="text" name="description" id='dc23'> </td>
                  </TR>
                </table>
              </div> <!-- hidden part -->
           </div> <!-- answersQ0 -->
      </td> <!-- answer column -->
    </tr>
    </table>
    <!-- END Quiz maker table -->
    <br>
    <!-- Add/delete quiz buttons -->
    <button onclick="addQuestionRow('creatorForQ1')">Add question</button>
    <button onclick="deleteQuestionRow('creatorForQ1')">Delete question</button>
    <!-- Submit button -->
    <button onclick="upload_quiz()">Submit</button>
    <!-- return string to be displayed -->
    <p id="ajax_return"></p>
    <p id="return_quiz_id"></p>
    <p id="return_question_id"></p>
    <p id="return_statement"></p>
</div>


<div id="quiz2" class="tabcontent">
  <h3>QUIZ2</h3>
  <p> Create questions for QUIZ2</p>
</div>

<div id="quiz3" class="tabcontent">
  <h3>QUIZ3</h3>
  <p> Create questions for QUIZ3</p>
</div>

<script>
//Oliver O'Hara

//JavaScript function intended to run when the submit button is pressed
//The function will retrieve the data for each row in turn and send it to the 
//database via an ajax call to a php function.

   function upload_quiz() {
      //Return the name of the quiz being submitted
      var quizName = document.getElementById('quizNameID');
      var quizID = null;

      //Only stores the quiz name once so runs before the for loop below
       $.ajax({
         url: "insertQuizName.php",
         cache: false,
         type: "post",
         data:
         {
            quizName: quizName.value
         }, //data
         success: function(data)
         {
            quizID = data;
            document.getElementById("return_quiz_id").innerHTML = "Added quiz";
            upload_questions(data);
         } //success function
      }) //ajax
   } //upload_quiz
   
   
   
   
      
   function upload_questions(quiz_id) {
      //Loop for the number of rows in the table
      numberOfRows = document.getElementById("creatorForQ1").rows.length - 1;
      var questionID = null;
      
      for (i = 0; i < numberOfRows; i++)
      {
		 //Set the question number so that it can be used in answer call
		 var current_question_number = i;
		 
         //Use i to construct the ID of each row
         questionID = "q" + i;   
         relatedNodeID = "rn" + i;
         
         //Use the constructed IDs and arrays to access the data
         var question = document.getElementById(questionID);
         var relatedNodeID = document.getElementById(relatedNodeID);
       
         //Use an Ajax call to an external php script to send the data
         $.ajax({
			async: false,
            url: "insertQuestions.php",
            cache: false,
            type: "post",
            data: 
            {
               question: question.value,
               relatedNodeID: relatedNodeID.value,
               quiz_id: quiz_id
            }, //data
            success: function(data) 
            {
               questionID = data;
               document.getElementById("return_question_id").innerHTML = "Added question";
               upload_answers(data, current_question_number);
            } //success function
         }) //ajax
      
      } //for
   } //upload_questions  
   
   
   
   
   function upload_answers(question_id, i) {
      //Store the answer letters in an array
      var letter = ["A","B","C","D"];
      
      //Loop through the four answers, storing one at a time
      for (n = 0; n <= 4; n++)
      { 
         
         //Use i and n to construct the ID of each answer, switch and description
         answerID = "ans" + i + n;   
         switchID = "swc" + i + n; 
         descriptionID = "dc" + i + n; 
            
         //Retrieve the answer using the constructed ID   
         answer = document.getElementById(answerID);
         
         alert("Test before");
           
         //Push either true or false based on the checkbox
         switchChecked = document.getElementById(switchID);
         if (switchChecked.checked == true)
            switchBit = 1;
         else
            switchBit = 0;
            
         //Retrieve the description using the constructed ID and push it to the array
         description = document.getElementById(descriptionID);
         
        
         //Use an Ajax call to an external php script to send the data
         $.ajax({
			async: false,
            url: "insertAnswers.php",
            cache: false,
            type: "post",
            data: 
            {
               answer: answer.value,
               switchBit: switchBit.value,
               description: description.value,
               letter: letter[n],
               question_id: question_id
            }, //data
            success: function(data) 
            {
               document.getElementById("return_statement").innerHTML = data;
            } //success function
         }) //ajax
         
         alert("Test after");
     
      }//for 
         
   } //upload_answers
   
   
   

  function testForErrors(returnedText)
  {
    console.log(returnedText);
  }
  

</script>

</body>


</html>

